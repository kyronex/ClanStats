<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public

    <Directory /var/www/html/public>
        AllowOverride All
        Order Allow,Deny
        Allow from All
        Require all granted
        FallbackResource /index.php
    </Directory>

    # ✅ AJOUT: Proxy pour Hot Reload Assets
    # Redirige les requêtes d'assets vers webpack dev server
    ProxyPreserveHost On
    ProxyRequests Off
    
    # Hot reload WebSocket
    ProxyPass /sockjs-node ws://127.0.0.1:8081/sockjs-node/
    ProxyPassReverse /sockjs-node ws://127.0.0.1:8081/sockjs-node/
    
    # Assets hot reload
    ProxyPass /build/hot http://127.0.0.1:8081/build/hot
    ProxyPassReverse /build/hot http://127.0.0.1:8081/build/hot
    
    # Hot update files
    ProxyPass /build/*.hot-update.json http://127.0.0.1:8081/build/$1.hot-update.json
    ProxyPassReverse /build/*.hot-update.json http://127.0.0.1:8081/build/$1.hot-update.json
    
    ProxyPass /build/*.hot-update.js http://127.0.0.1:8081/build/$1.hot-update.js
    ProxyPassReverse /build/*.hot-update.js http://127.0.0.1:8081/build/$1.hot-update.js
    
    # Runtime principal (uniquement en dev)
    <LocationMatch "^/build/runtime\.js$">
        ProxyPass http://127.0.0.1:8081/build/runtime.js
        ProxyPassReverse http://127.0.0.1:8081/build/runtime.js
    </LocationMatch>
    
    # App principal (uniquement en dev)
    <LocationMatch "^/build/app\.js$">  
        ProxyPass http://127.0.0.1:8081/build/app.js
        ProxyPassReverse http://127.0.0.1:8081/build/app.js
    </LocationMatch>

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>