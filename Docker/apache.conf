<VirtualHost *:80>

    ServerName localhost
    ServerAlias www.localhost
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public

    # Configuration Symfony de base
    <Directory /var/www/html/public>
        AllowOverride All
        Require all granted
        FallbackResource /index.php
    </Directory>

    # ðŸŽ¯ CONFIGURATION PROXY SIMPLIFIÃ‰E
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyTimeout 300

    # ðŸŽ¯ WebSocket pour Hot Module Replacement
    ProxyPass /ws ws://127.0.0.1:8081/ws retry=0 timeout=30
    ProxyPassReverse /ws ws://127.0.0.1:8081/ws

    # ðŸŽ¯ ASSETS WEBPACK - Configuration simple et efficace
    ProxyPass /build/ http://127.0.0.1:8081/build/ retry=0 timeout=30
    ProxyPassReverse /build/ http://127.0.0.1:8081/build/

    # ðŸŽ¯ Headers CORS pour tous les assets
    <LocationMatch "^/build/">
        <IfModule mod_headers.c>
            Header always set Access-Control-Allow-Origin "*"
            Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Header always set Access-Control-Allow-Headers "X-Requested-With, Content-Type, Authorization"
            Header always set Cache-Control "no-cache, max-age=0"
        </IfModule>
    </LocationMatch>

    # ðŸŽ¯ Support infrastructure webpack-dev-server
    ProxyPass /__webpack_dev_server__/ http://127.0.0.1:8081/__webpack_dev_server__/ retry=0 timeout=30
    ProxyPassReverse /__webpack_dev_server__/ http://127.0.0.1:8081/__webpack_dev_server__/

    # ðŸŽ¯ Support HMR
    ProxyPass /__webpack_hmr http://127.0.0.1:8081/__webpack_hmr retry=0 timeout=30
    ProxyPassReverse /__webpack_hmr http://127.0.0.1:8081/__webpack_hmr

    # Logs pour debug
    ErrorLog ${APACHE_LOG_DIR}/symfony_error.log
    CustomLog ${APACHE_LOG_DIR}/symfony_access.log combined
    LogLevel info proxy:debug
</VirtualHost>
<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html/public

    # Configuration Symfony de base
    <Directory /var/www/html/public>
        AllowOverride All
        Require all granted
        FallbackResource /index.php
    </Directory>

    # ðŸŽ¯ CONFIGURATION PROXY SIMPLIFIÃ‰E
    ProxyPreserveHost On
    ProxyRequests Off
    ProxyTimeout 300

    # ðŸŽ¯ WebSocket pour Hot Module Replacement
    ProxyPass /ws ws://127.0.0.1:8081/ws retry=0 timeout=30
    ProxyPassReverse /ws ws://127.0.0.1:8081/ws

    # ðŸŽ¯ ASSETS WEBPACK - Configuration simple et efficace
    ProxyPass /build/ http://127.0.0.1:8081/build/ retry=0 timeout=30
    ProxyPassReverse /build/ http://127.0.0.1:8081/build/

    # ðŸŽ¯ Headers CORS pour tous les assets
    <LocationMatch "^/build/">
        <IfModule mod_headers.c>
            Header always set Access-Control-Allow-Origin "*"
            Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
            Header always set Access-Control-Allow-Headers "X-Requested-With, Content-Type, Authorization"
            Header always set Cache-Control "no-cache, max-age=0"
        </IfModule>
    </LocationMatch>

    # ðŸŽ¯ Support infrastructure webpack-dev-server
    ProxyPass /__webpack_dev_server__/ http://127.0.0.1:8081/__webpack_dev_server__/ retry=0 timeout=30
    ProxyPassReverse /__webpack_dev_server__/ http://127.0.0.1:8081/__webpack_dev_server__/

    # ðŸŽ¯ Support HMR
    ProxyPass /__webpack_hmr http://127.0.0.1:8081/__webpack_hmr retry=0 timeout=30
    ProxyPassReverse /__webpack_hmr http://127.0.0.1:8081/__webpack_hmr

    # Logs pour debug
    ErrorLog ${APACHE_LOG_DIR}/symfony_error.log
    CustomLog ${APACHE_LOG_DIR}/symfony_access.log combined
    LogLevel info proxy:debug
</VirtualHost>
